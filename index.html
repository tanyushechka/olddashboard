<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard</title>

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/fullcalendar.min.css' rel='stylesheet'/>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/fullcalendar.print.css' rel='stylesheet'
          media='print'/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/fullcalendar.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/lang/ru.js'></script>
    <script src="https://www.google.com/jsapi"></script>

    <script>
        google.load('visualization', '1', {'packages': ['corechart', 'table', 'timeline']});
        google.setOnLoadCallback(drawAllCharts);

        var date = new Date();
        var month = date.getMonth() + 1;
        var year = date.getFullYear() - 1;
        var monthNext = (month == 12) ? 1 : month + 1;
        var yearNext = (month == 12) ? year + 1 : year;
        var intervalStart = new Date(year, month, 1, 0, 0, 0, 0).valueOf() / 1000;
        var intervalEnd = new Date(yearNext, monthNext, 1, 0, 0, 0, 0).valueOf() / 1000;
        var chartType = 'bar';
        var data = null;
        var options = {
            legend: {position: 'top', maxLines: 3},
            bar: {groupWidth: '75%'},
            isStacked: true
        };

        function drowChart() {
            var chart;
            switch (chartType) {
                case 'bar' :
                    chart = new google.visualization.BarChart(document.getElementById('div-chart'));
                    chart.draw(data, options);
                    break;
                case 'column' :
                    chart = new google.visualization.ColumnChart(document.getElementById('div-chart'));
                    chart.draw(data, options);
                    break;
                case 'area' :
                    chart = new google.visualization.SteppedAreaChart(document.getElementById('div-chart'));
                    chart.draw(data, options);
                    break;
                default :
                    chart = new google.visualization.BarChart(document.getElementById('div-chart'));
                    chart.draw(data, options);
                    break;
            }

        }

        function drawAllCharts() {

            var arrData = [];
            arrData[0] = ['contact_id', 'development', 'support', 'marketing', 'documents', 'negotiations'];
            $.get(
                    '/getData.php', {start: intervalStart, end: intervalEnd}, function (response) {
                        for (var key in response) {
                            var arrStr = [];
                            arrStr[0] = key;
                            for (var i = 0; i <= 4; i++) {
                                var curVal = +response[key][i];
                                if (isNaN(curVal)) {
                                    curVal = 0;
                                }
                                arrStr.push(curVal);
                            }
                            arrData.push(arrStr);
                        }
                        data = new google.visualization.arrayToDataTable(arrData, false);

                        var table_chart = new google.visualization.Table(document.getElementById('table-chart'));
                        table_chart.draw(data, options);

                        var pie_chart = new google.visualization.PieChart(document.getElementById('pie-chart'));
                        pie_chart.draw(data, options);

                        drowChart();

                    }, 'json'
            );


        }


    </script>
    <style>

        body {
            background-color: #eee;
        }

        section {
            margin-top: 100px;
        }

        .col-md-12,
        .col-md-6 {
            /*margin-bottom: 30px;*/
            margin: 0 auto;
        }

        #calendar {
            max-width: 800px;
            height: 30px;
            margin: 20px auto;
        }

        #calend {
            background-color: #71B7DA;
            background-color: #a4a4a4;
            height: 70px;
            color: #ffffff;
            position: fixed;
            top: 0;
            z-index: 100;
            width: 100%;
        }

        #table-chart,
        #pie-chart {
            /*min-width: 500px;*/
            /*margin: 0 auto;*/
            min-height: 400px;
        }

        #div-chart {
            min-height: 600px;
        }

    </style>

</head>

<body>


<div id="calend" class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div id='calendar'></div>
        </div>
    </div>
</div>


<section>
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div id="table-chart"></div>
            </div>
            <div class="col-md-6">
                <div id="pie-chart"></div>
            </div>
        </div>
    </div>
</section>

<section>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="btn-group btn-group-justified" role="group" aria-label="...">
                            <div class="btn-group" role="group">
                                <button id="button-bar" class="btn btn-primary" type="button">Bar</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button id="button-column" class="btn btn-warning" type="button">Column</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button id="button-area" class="btn btn-danger" type="button">Area</button>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div id="div-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<script>
    $(function () {

        $('#calendar').fullCalendar({
            firstDay: 1,
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,basicWeek,basicDay'
            },
            lang: 'ru'
        });

        $('.fc-view-container').remove();

        $('.fc-button').click(function () {
            var view = $('#calendar').fullCalendar('getView');
            intervalStart = +view.intervalStart._d / 1000 - 31536000;
            intervalEnd = +view.intervalEnd._d / 1000 - 31536000;
            drawAllCharts();
        });

        $('#button-bar').click(function () {
            chartType = 'bar';
            drowChart();
        });

        $('#button-column').click(function () {
            chartType = 'column';
            drowChart();
        });

        $('#button-area').click(function () {
            chartType = 'area';
            drowChart();
        });


    });


</script>

</body>

</html>
